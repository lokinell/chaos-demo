# 演示使用chaos mesh来做混沌测试

本项目演示如何使用 Chaos Mesh 进行混沌工程测试，帮助验证系统在各种故障场景下的弹性和稳定性。

## 如何安装chaos mesh

Chaos Mesh 可以通过 Helm 安装到 Kubernetes 集群中：

```bash
# 添加 Chaos Mesh 的 Helm 仓库
helm repo add chaos-mesh https://charts.chaos-mesh.org
helm repo update

# 创建命名空间
kubectl create ns chaos-testing

# 安装 Chaos Mesh
helm install chaos-mesh chaos-mesh/chaos-mesh --namespace=chaos-testing --set chaosDaemon.runtime=containerd --set chaosDaemon.socketPath=/run/containerd/containerd.sock
```

详细的安装步骤请参考 [DEMO.md](DEMO.md) 文件。

## 测试的内容

本项目包含以下混沌测试场景：

1. redis服务不可用
   1. memory stress - 对 Redis 施加内存压力
   2. cpu stress - 对 Redis 施加 CPU 压力
2. 数据库连接不了 - 模拟 MySQL 数据库连接失败
3. 某个pod挂了
   1. pod failure - 模拟 Pod 暂时不可用
   2. pod kill - 模拟 Pod 被终止
   3. container kill - 模拟容器被终止
4. 网络连接问题
   1. network partition - 模拟网络分区
   2. network emulation - 模拟网络延迟和丢包

## 项目结构

```
.
├── app.py                      # 演示应用程序代码
├── requirements.txt            # Python 依赖
├── Dockerfile                  # 构建应用容器的 Dockerfile
├── deploy.sh                   # 部署应用的脚本
├── cleanup-chaos.sh            # 清理混沌实验的脚本
├── k8s/                        # Kubernetes 配置文件
│   └── demo-app.yaml           # 演示应用的 Kubernetes 部署文件
└── chaos/                      # Chaos Mesh 实验配置文件
    ├── redis-memory-stress.yaml
    ├── redis-cpu-stress.yaml
    ├── mysql-connection-failure.yaml
    ├── pod-failure.yaml
    ├── pod-kill.yaml
    ├── container-kill.yaml
    ├── network-partition.yaml
    └── network-emulation.yaml
```

## 如何运行

1. 确保您有一个正常运行的 Kubernetes 集群
2. 安装 Chaos Mesh（见上文）
3. 运行部署脚本：`./deploy.sh`
4. 按照 [DEMO.md](DEMO.md) 中的步骤执行混沌测试

## 如何清理chaos 

要清理所有混沌实验，可以运行：

```bash
./cleanup-chaos.sh
```

或者手动执行：

```bash
kubectl -n demo delete podchaos,networkchaos,stresschaos --all
```

如需卸载 Chaos Mesh：

```bash
helm uninstall chaos-mesh -n chaos-testing
kubectl delete ns chaos-testing
```

